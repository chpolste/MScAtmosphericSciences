#! /usr/bin/env bash

source /home/chris/local/miniconda3/bin/activate thesis

python db_import.py raso_fwf ../data/db_parts/raso_fwf.db --pid=1 --size=1

python db_import.py raso_bufr ../data/db_parts/raso_bufr1.db --pid=3200 --offset=0   --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr2.db --pid=3350 --offset=150 --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr3.db --pid=3500 --offset=300 --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr4.db --pid=3650 --offset=450 --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr5.db --pid=3800 --offset=600 --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr6.db --pid=3950 --offset=750 --size=150 &
python db_import.py raso_bufr ../data/db_parts/raso_bufr7.db --pid=4100 --offset=900 --size=150 &

wait

python <<<'''
from dbtoolbox import DatabaseToolbox
DatabaseToolbox("../data/amalg.db").create_tables()
'''

sqlite3 ../data/amalg.db <<< '''
ATTACH "../data/db_parts/raso_fwf.db" AS fwf;
ATTACH "../data/db_parts/raso_bufr1.db" AS bufr1;
ATTACH "../data/db_parts/raso_bufr2.db" AS bufr2;
ATTACH "../data/db_parts/raso_bufr3.db" AS bufr3;
ATTACH "../data/db_parts/raso_bufr4.db" AS bufr4;
ATTACH "../data/db_parts/raso_bufr5.db" AS bufr5;
ATTACH "../data/db_parts/raso_bufr6.db" AS bufr6;
ATTACH "../data/db_parts/raso_bufr7.db" AS bufr7;

INSERT INTO raso SELECT * FROM fwf.raso;
INSERT INTO raso SELECT * FROM bufr1.raso;
INSERT INTO raso SELECT * FROM bufr2.raso;
INSERT INTO raso SELECT * FROM bufr3.raso;
INSERT INTO raso SELECT * FROM bufr4.raso;
INSERT INTO raso SELECT * FROM bufr5.raso;
INSERT INTO raso SELECT * FROM bufr6.raso;
INSERT INTO raso SELECT * FROM bufr7.raso;

INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM fwf.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr1.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr2.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr3.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr4.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr5.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr6.rasodata ORDER BY id ASC;
INSERT INTO rasodata (parent, p, geopot, T, Td) SELECT parent, p, geopot, T, Td FROM bufr7.rasodata ORDER BY id ASC;
'''
