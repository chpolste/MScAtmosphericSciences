\startsection[title=The Radiative Transfer Equation]

    General form, absorption only, Rayleigh-Jeans â†’ Brightness Temperatures.
    Discretization.

    Differential form of RTE without scattering

    \startformula
        \DERIV{I_\nu}{s} = - I_\nu \ABSCOEF + F \EQCOMMA
    \stopformula

    where $I_\nu$ is spectral radiance (power per frequency and solid angle in
    a specific direction), $\ABSCOEF$ is the absorption coefficient of the medium
    ($0 \lt \ABSCOEF \lt 1$), $F$ is a source term and $s$ is distance in beam
    direction.

    The only source term considered here is emission according to Planck's law

    \startformula
        F = \epsilon B_\nu(T) \EQCOMMA
    \stopformula

    where $\epsilon$ is the emission coefficient of the radiating medium
    describing its difference to an ideal black body ($0 \lt \epsilon \lt 1$)
    and $B_\nu(T)$ is the Planck function giving the emitted spectral radiance
    of a black body. Under the assumption of thermodynamic equilibrium the
    absorption and emission coefficients are equal (Kirchhoff's law).
    Substitute into RTE (REFERENCE) to obtain

    \startformula
        \DERIV{I_\nu}{s} = - \ABSCOEF(I_\nu - B_\nu(T)) \EQSTOP
    \stopformula

    For temperatures occuring in the atmosphere the Planck function in the
    microwave region is represented well by the Rayleigh-Jeans approximation
    which relates the spectral radiance at a given frequency linearly to
    temperature

    \startformula
        B_\nu(T) \approx \frac{2 \nu^2 k T}{c^2} \EQSTOP
    \stopformula

    By expressing the spectral radiance $I_\nu$ with the concept of brightness
    temperature $\BT$ (which is the temperature a blackbody would have to have
    in order to reproduce the emission by a grey body) and the Rayleigh-Jeans
    approximation, the radiative transfer equation can be expressed exclusively
    in terms of temperatures:

    \startformula
        \DERIV{\BT}{s} = - \ABSCOEF (\BT - T) \EQSTOP
    \stopformula

    \startsubsection[title={A Solution for Ground-based Radiometer Applications}]

        Assumption of horizontally homogeneous atmosphere, relate distance
        towards radiometer $s$ to height above radiometer $z$

        \startformula
            \DERIV{s}{z} = - \frac{1}{\cos(\theta)} \EQCOMMA
        \stopformula

        where the azimuth angle $\theta$ is defined as the deviation from
        zenith.  Because height increases with height but radiation arriving at
        the radiometer is downwelling, the sign of the derivative is negative.

        In order to solve the radiative transfer equation after the coordinate
        transformation, optical depth $\OD$ is introduced

        \startformula
        \startalign[n=3,align={left,right,left}]
            \NC \NC \OD(s) = \NC \int_{s_0}^{s} \ABSCOEF(u) \diff u \NR
            \NC \Rightarrow~ \NC \OD(z) = \NC
                - \frac{1}{\cos(\theta)} \int_{z_0}^{z} \ABSCOEF(u) \diff u \NR
            \NC \Rightarrow~ \NC \DERIV{\OD}{z} = \NC
                - \frac{\ABSCOEF}{\cos(\theta)} \EQCOMMA \NR
        \stopalign
        \stopformula

        and REFERENCE is multiplied on both sides by $e^{\OD}$ and
        rearranged, yielding

        \startformula
            \DERIV{\BT}{z} e^\OD + \frac{\ABSCOEF \BT e^\OD}{\cos(\theta)}
            = \DERIV{(\BT e^\OD)}{z}
            = - \frac{\ABSCOEF T e^\OD}{\cos(\theta)} \EQSTOP
        \stopformula

        Integrating this from the surface ($z = 0$) to space ($z = \infty$)
        gives an expression for the brightness temperature measured by the
        radiometer $\BT(0)$:

        \startformula
            \BT(0) = \BT(\infty) e^{\OD(\infty)} + \frac{1}{\cos(\theta)}
                \int_{0}^{\infty} \ABSCOEF(z) T(z) e^{\OD(z)} \diff z \EQSTOP
        \stopformula

        $T_B(\infty)$ is given by the cosmic background (describe), the
        absorption coefficient can be determined from the atmospheric profile
        (see section REFERENCE).

    \stopsubsection

    \startsubsection[title={Numerical Treatment}]

        Discretization, quadrature (trapezoidal rule).

    \stopsubsection

\stopsection


\startsection[title=Representation of the Atmospheric State]

    Discretization in the vertical, selecting state vector variables:
    compromise between dimensionality and information content (including
    forward model needs).

    \startsubsection[title=The Choice of State Vector Variables]

        Pressure as fixed variable (recalculated by hydrostatic equilibrium
        after each iteration, check if this is good approximation when compared
        to radiosonde measurements). Temperature and humidity as variable
        state quantities. To reduce dimensionality: use knowledge of qsat to
        combine water vapor and liquid water content into a single variable
        qtot. No representation of ice due to negligible absorption in
        microwave region (see below INSERT REF). The individual components are
        then recovered by a partition function

        \startformula
            \DERIV{\QLIQ}{\RHL} = \frac{1}{\QSAT} \startcases
                \NC 0 \MC s \lt 0.95 \NR
                \NC \cos \left( \frac{\RHL - 1.05}{0.1} \frac{\pi}{2} \right)^2
                    \MC 0.95 \le s \le 1.05 \EQCOMMA\NR
                \NC 1 \MC 1.05 \lt s \NR
            \stopcases
        \stopformula

        where

        \startformula
            \RHL = \frac{\QTOT}{\QSAT} = \frac{\QVAP + \QLIQ}{\QSAT} \EQSTOP
        \stopformula

        Hewison, Deblonde, (COSMO7 fixes RH at 100 \% in clouds). Integrate,
        get values for qliq and qvap.

        \startformula
            \QLIQ(\RHL) = \startcases
                \NC 0 \MC s \lt 0.95 \NR
                \NC \frac{\QSAT}{2} \left( \RHL - 0.95 - \frac{0.1}{\pi}
                    \cos \left( \frac{\pi \RHL}{0.1} \right) \right)
                    \MC 0.95 \le s \le 1.05 \NR
                \NC \QLIQ(1.05) + \QSAT (\RHL - 1.05) \MC 1.05 \lt s \NR
            \stopcases
        \stopformula

        and from REF to s = qtot/qsat

        \startformula
            \QVAP(\RHL) = \QSAT(\RHL) - \QLIQ(\RHL) \EQSTOP
        \stopformula

        Additionally: use ln(qtot) in state vector to enforce positivity and
        better error characteristics.

        \cite[Hewison2006]

    \stopsubsection

    \startsubsection[title=Vertical Discretization and Interpolation]

        Smoothing: interpolation scheme is very important and might affect the
        resulting brightness temperatures calculated by the model. Proposed
        discretizations: add levels dynamically to keep all extrema, this is
        good for inversion situations but only applicable if the regions with
        problematic values are known beforehand, which is not the case for
        real-time retrievals. When NWP model is used for a-priori, it is
        convenient to use the model grid, but impossible for stations like
        Innsbruck where model topography often ends much higher up than
        actual location of instrument. Generally it is desirable to have higher
        resolution in the lower atmosphere, where more stuff happens and
        at which heights the model has high sensitivity, so numerical errors
        should be kept as small as possible.

        Compromise between resolution necessary for numerical model (as many
        levels as possible) and actual information content (only few levels).
        More levels are more expensive to calculate. Inclusion of upper
        atmosphere or not.

    \stopsubsection

\stopsection


\startsection[title=Atmospheric Extinction]

    Neglecting scattering. Existing absorption models.

    Gaseous Absorption: molecule transitions. Oxygen, Water vapor. What about
    nitrogen or CO2?  Included in Liebe Model or negligible? I think Hewison
    had nitrogen as well.

    Liquid Water Extinction: Rayleigh-approximation. Problems during
    precipitation due to scattering.

\stopsection


\startsection[title=Fast Absorption Prediction]

    Fitting a polynomial to the absorption at a specific line to speed up
    calculations and simplify derivatives. Evaluate FAP performance for
    each line of the HATPRO. Training data: synthetic gridded data
    representative for a wide variety of atmospheric states. Climatology is
    test dataset. Climatology is not used for training due to profiles being
    mostly at night and night, therefore temperatures are not representative
    of whole range of realistic values. Climatology is valuable as independent
    test set.

\stopsection


\startsection[title=Linearization]

    Necessary for iterative optimal estimation approach.

    Possibility of truncating the Jacobian at upper levels.

    \startsubsection[title=Weighting Functions]

        Weighting functions/averaging kernels. Givve examples for different
        angles.

    \stopsubsection

    \startsubsection[title=Calculating the Jacobian]

        Brute force: can be used with every model. Problems with selection of
        perturbations, non-linearity (e.g. at liquid water boundary).

        Symbolic differentiation: often unaffordable due to model complexity.
        Automatic differentiation can help but requires model that is
        compatible to AD-compiler. Approach here: strip model down to bare
        essentials, use FAP to allow easy symbolic differentiation of
        absorption model, thus allowing the exact computation of the Jacobian.
        
    \stopsubsection

\stopsection


\startsection[title=A Numerical Model]

    Custom implementation of a line-by-line model with a mix of automatic and
    symbolic differentiation to calculate accurate and fast jacobians.
    Specializing in one model per frequency allows additional optimizations
    and optimizied FAPs.

    Stripped-down model, includes only the bare minimum of physical processes.
    This means larger errors, but allows exact linearization.

    Bending due to changing refractive index negligible due to instrument's
    sensitivity in lower atmosphere?

    Numerical discretization very important for accurate results, high vertical
    resolution especially in the lower troposphere is required to obtain
    accurate numerical results.

    \startsubsection[title=Implementation]

        Custom implementation of Liebe gas absorption, Turner et al. cloud
        absorption. 4-th order FAP for each frequency. Caching and autodiff
        for fast evalutation of Jacobians.

    \stopsubsection

    \startsubsection[title=Comparison with MonoRTM]

        Introduce MonoRTM wrapper. Statistical comparison of brightness
        temperatures (variablility and bias) as well as jacobians for some
        radiosonde subset.

    \stopsubsection

    \startsubsection[title={Characterizing Errors},reference={ch:rtm_errors}]

        Building part of the forward model covariance matrix.

        Compare exact Jacobian with brute force Jacobian.

        FAP errors: determine from climatology by comparison of exact
        calculations with FAP predictions.

        Discretization errors: deterine from climatology by comparing
        interpolated profiles with full resolution profiles.

    \stopsubsection

\stopsection

